services:
  # ---------------------------------------
  # 1. Backend Service
  # ---------------------------------------
  - type: web
    name: chaintorque-backend
    runtime: node
    plan: free
    buildCommand: npm install --legacy-peer-deps
    startCommand: npm run --workspace=chaintorque-backend start
    branch: main
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGODB_URI
        sync: false
      - key: RPC_URL
        sync: false
      - key: PRIVATE_KEY
        sync: false
      - key: CONTRACT_ADDRESS
        sync: false
      - key: CLERK_PUBLISHABLE_KEY
        sync: false
      - key: LIGHTHOUSE_API_KEY
        sync: false

  # ---------------------------------------
  # 2. Marketplace Frontend
  # ---------------------------------------
  - type: web
    name: chaintorque-marketplace
    runtime: node
    plan: free
    buildCommand: npm install --legacy-peer-deps && npm run --workspace=chaintorque-marketplace build
    startCommand: npx serve "Marketplace (Frontend)/dist" -s -l ${PORT:-10000}
    branch: main
    envVars:
      - key: VITE_API_URL
        sync: false
      - key: VITE_CLERK_PUBLISHABLE_KEY
        sync: false
      - key: VITE_CONTRACT_ADDRESS
        sync: false

  # ---------------------------------------
  # 3. Landing Page Frontend
  # ---------------------------------------
  - type: web
    name: chaintorque-landing
    runtime: node
    plan: free
    buildCommand: npm install --legacy-peer-deps && npm run --workspace=chaintorque-landing build
    startCommand: npx serve "Landing Page (Frontend)/dist" -s -l ${PORT:-10000}
    branch: main
    envVars:
      - key: VITE_CLERK_PUBLISHABLE_KEY
        sync: false

  # ---------------------------------------
  # 4. CAD Frontend
  # ---------------------------------------
  - type: web
    name: chaintorque-cad
    runtime: node
    plan: free
    buildCommand: npm install --legacy-peer-deps && npm run --workspace=chaintorque-cad-frontend build
    startCommand: npx serve "CAD (Frontend)/build" -s -l ${PORT:-10000}
    branch: main
