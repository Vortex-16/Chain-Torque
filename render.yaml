services:
  # ---------------------------------------
  # 1. Backend Service
  # ---------------------------------------
  - type: web
    name: chaintorque-backend
    runtime: node
    plan: free
    buildCommand: cd backend && npm install --legacy-peer-deps && npm run compile
    startCommand: cd backend && npm start
    branch: main
    envVars:
      - key: NODE_ENV
        value: production
      - key: MONGODB_URI
        sync: false
      - key: RPC_URL
        sync: false
      - key: PRIVATE_KEY
        sync: false
      - key: CONTRACT_ADDRESS
        sync: false
      - key: CLERK_PUBLISHABLE_KEY
        sync: false
      - key: LIGHTHOUSE_API_KEY
        sync: false

  # ---------------------------------------
  # 2. Marketplace Frontend
  # ---------------------------------------
  - type: web
    name: chaintorque-marketplace
    runtime: node
    plan: free
    buildCommand: cd "Marketplace (Frontend)" && npm install --legacy-peer-deps && npm run build
    startCommand: cd "Marketplace (Frontend)" && npx serve dist --single --listen ${PORT:-10000}
    branch: main
    envVars:
      - key: VITE_API_URL
        sync: false
      - key: VITE_CLERK_PUBLISHABLE_KEY
        sync: false

  # ---------------------------------------
  # 3. Landing Page Frontend
  # ---------------------------------------
  - type: web
    name: chaintorque-landing
    runtime: node
    plan: free
    buildCommand: cd "Landing Page (Frontend)" && npm install --legacy-peer-deps && npm run build
    startCommand: cd "Landing Page (Frontend)" && npx serve dist --single --listen ${PORT:-10000}
    branch: main
    envVars:
      - key: VITE_CLERK_PUBLISHABLE_KEY
        sync: false

  # ---------------------------------------
  # 4. CAD Frontend
  # ---------------------------------------
  - type: web
    name: chaintorque-cad
    runtime: node
    plan: free
    buildCommand: cd "CAD (Frontend)" && npm install --legacy-peer-deps && npm run build
    startCommand: cd "CAD (Frontend)" && npx serve build --single --listen ${PORT:-10000}
    branch: main
